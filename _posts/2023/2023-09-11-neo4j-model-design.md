---
title: Neo4j 模型设计
date: 2023-09-11 14:31:57 +0800
categories: [博客]
tags: [Neo4j] 
---


[原文地址](https://neo4j.com/docs/getting-started/data-modeling/modeling-designs/)
:::info
在本节中，您将学习如何使用各种建模决策来表示图形数据。构建数据模型的方式会影响查询和性能。我们的目标是向您展示如何评估您的模型并进行适当的更改，以便您可以为您的用例定义最佳解决方案并最大限度地提高查询性能。
:::
### 为什么数据模型会产生影响
与任何数据库一样，您设计的数据模型对于确定查询逻辑和存储数据结构非常重要。这种做法扩展到了图数据库，但有一个例外。 Neo4j 是无模式的，这意味着您的数据模型可以根据您的业务轻松适应和更改。

需要开始收集新领域并捕获新分析？或者需要改变您解释客户或其他实体的方式并修改其定义？或者法规要求系统捕获更少的信息或限制可读性（更改数据格式/类型）？

您可能曾在一家公司工作过，其中每个领域或部门对域的定义都不同。以通用客户域为例。对于企业内的不同领域，客户可以被定义为不同类型的个人。这些定义也可能随着时间的推移而改变，或者公司可能决定跨部门统一客户的含义。

 
在接下来的几段中，我们将介绍几种不同的方法来查看不同的数据集，并展示每种方法如何影响遍历图数据的查询和性能。

属性（Property）和关系（Relationship）
您可能遇到的最早的决定之一是：否将某些内容建模为节点上的属性或与单独节点的关系。
例如，以下数据将电影类型（Moive genre）建模为电影节点（Movie Node）上的属性。
![属性](https://cdn.nlark.com/yuque/0/2023/jpeg/35987817/1694745599961-39f4cb55-7e67-4024-921d-dcb28791708f.jpeg)
编写查找特定电影类型（genres）的查询非常简单。它将找到它想要了解的 Movie 节点，然后返回在类型属性中列出的值。

但是，要找出哪些电影是相同类型（geners），您需要更复杂的查询来查找每个 电影（Movie) 节点，循环属性数组中的每个流派，并与第二部电影的流派属性数组中的每个值进行比较。这会影响性能（嵌套循环和节点属性的比较），并且查询也会变得更加复杂。
 
下面的代码块是每个查询的语法。您可以在第二个查询中看到循环的逻辑和复杂性的变化。
```cypher
// find the genres for a particular movie
MATCH (m:Movie {title: "The Matrix"})
RETURN m.genre;

// find which movies share genres
MATCH (m1:Movice),(m2:Movice) 
WHERE any( x IN m1.genre WHERE x IN m2.genre)
AND m1 <> m2
RETURN m1, m2;
```
现在，如果您要将电影及其类型建模为单独的节点并在它们之间创建关系，您将得到如下图所示的模型：
![模型](https://cdn.nlark.com/yuque/0/2023/jpeg/35987817/1694747587680-af137ceb-88f8-4f2c-a9c1-5a6a9ef99f50.jpeg)
这会为该类型创建一个完全独立的实体（节点），允许您将具有共同类型（`genre`）的所有电影连接到该 `genre`节点。
让我们看看这如何改变我们的查询。要查找特定电影的类型：

- 首先需要找到它正在查找的电影节点，在本例中为“黑客帝国（The Matrix）”
- 然后找到通过 `IN_GENRE` 关系连接到该电影的节点。
```cypher
// find the genres for a particular movie
MATCH (m:Movie {title:"The Matrix"}),
    	(m) -[:IN_GENRE]-> (g:Genre)
RETURN g.name;

// find which movies share genres
MATCH (m1:Movie)-[:IN_GENRE]->(g:Gnre),
  	  (m2:Movie)-[:IN_GENRE]->(g)
RETURN m1,m2,g
```
最大的区别在于第二个查询的语法，用于查找哪些电影共享类型。它比我们早期的版本简单得多，因为它使用自然的图形模式（实体-关系-实体）来查找所需的信息。首先，Cypher® 查找一部电影及其相关类型，然后查找同一类型的第二部电影。

 
数据模型的两个版本都没有更差或更好，但“最佳”选项在很大程度上取决于您打算针对数据运行的查询类型。

如果您计划对单个项目进行分析并仅返回有关该实体的详细信息（例如特定电影的类型），那么第一个数据模型将非常适合您的需求。但是，如果您需要运行分析来查找实体之间的共同点或查看一组节点，那么第二个数据模型肯定会提高这些类型查询的性能。

###  复杂的数据结构
